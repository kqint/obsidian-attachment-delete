# Attachment Delete

`Attachment Delete` 是一款 Obsidian 的**右键附件删除工具**。

可以在笔记中右键附件链接删除附件链接及对应文件，自动识别并清理附件的上级空文件夹。

## ✨ 核心功能

### 1. 智能删除与引用保护

- **右键一键删除**：在笔记（暂不支持白板 Canvas ）中的附件链接（图片、PDF、视频、音频等）上点击右键，即可看到红色的“**删除附件**”选项。
- **全库引用检测**：在物理删除前，自动检索全库是否有该笔记和其他笔记引用此附件，如果有，仅移除链接而保留物理文件并提示，防止误删。

### 2. 自定义回收站策略

在设置中根据对数据的安全需求，选择不同的处理方式：

- **移至系统回收站**：文件进入 Windows 回收站或 macOS 废纸篓。
- **移至本地回收站**：文件移至库根目录下的 `.trash` 隐藏文件夹。
- **永久删除**：文件直接从磁盘抹除，不经过任何回收站（**请谨慎使用**）。

### 3. 级联空文件夹清理

- **自动溯源**：删除附件后，如果其所在的文件夹变为空，插件会自动向上追溯并删除空文件夹，直到遇到非空文件夹或用户指定的“停止文件夹”。
- **透明反馈**：清理成功后，通知弹窗会明确列出**被删除的文件夹名称**，让你掌控每一个操作细节。
- **风险预警**：当级联删除的文件夹层数超过3层时，会弹出确认窗口并展示完整的路径列表。



## ⚙️ 插件设置

| **设置项**       | **说明**                                                     |
| ---------------- | ------------------------------------------------------------ |
| **回收站策略**   | 选择删除附件后的去向（系统/本地/永久）。                     |
| **启用级联删除** | 是否在附件删除后自动清理产生的空文件夹（默认开启）。         |
| **停止删除名单** | 设置保护文件夹名称（如 `assets`, `attachments`），删除逻辑遇到这些名称将停止（默认包含`assets`）。 |
| **开启确认提醒** | 开启后，级联层数超过阈值会弹窗拦截（默认开启）。             |
| **提醒触发阈值** | 设置触发层数，例如设为 `3`，则删除 3 层以上文件夹时会提示。  |

## 🛠️ 安装方法

1. 从 [Release](https://github.com/kqint/obsidian-attachment-delete/releases) 页面下载 `main.js`, `manifest.json`, `styles.css`。
2. 进入你的 Obsidian 库文件夹：`.obsidian/plugins/`。
3. 创建文件夹 `attachment-delete`。
4. 将下载的文件放入该文件夹。
5. 在 Obsidian 设置 -> 插件中心启用。



## 🐞 Bug 反馈与调试

如果您在使用过程中遇到问题（如文件未正常删除或报错），请按照以下步骤提供信息：

1. **查看控制台日志**：
   - 按下 `Ctrl + Shift + I` (Windows/Linux) 或 `Cmd + Option + I` (Mac)。
   - 切换到 **Console (控制台)** 选项卡。
2. **复现问题**：
   - 执行一次“删除附件”操作。
   - 观察控制台输出的红色错误信息。
3. **提交反馈**：
   - 提交到 [issues](https://github.com/kqint/obsidian-attachment-delete/issues)。

## 📜 许可证

[MIT License](https://github.com/kqint/obsidian-attachment-delete/blob/main/LICENSE)
